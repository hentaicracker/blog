---
title: 使用 Skia 绘制 2.5D 模型背景
date: 2022-11-01 18:13:12
tags:
  - JavaScript
---

## skia

1. skia 简单介绍
  - 2D 图形绘制库，支持 C++/C#/Java/Python/WASM 等
  - skia canvaskit —— WebAssembly

2. 画图 API 
  - canvas —— 画布
  - Path —— 路径
  - Paint —— 画笔
  - Shader —— 着色器
  - Matrix (Matrix3x3、Matrix4x4) —— 矩阵计算工具

## 图层分析

1. 图层拆解
  - 每个模型有两面或者三面，即把每个面单独看做一个图形，将每个面组合起来就构成了整个背景。

2. 单个图形拆解
 - 背景层
 - 线条层
 - 方格层

## 图形变换

1. 平移变换

  - Matrix.translated() 将图形整体平移至中线。

2. 反转变换

  - Matrix.rotated() 将图形整体旋转 180 度。

3. 透视变换

  - 三维旋转：通过 Matrix4x4 矩阵旋转，并通过 camera 投影得到旋转后的坐标。
  - 二维透视：通过初始设定参数（矩形宽高、放大倍数）计算出透视矩阵，通过透视矩阵进行二维变换。

## 图形绘制

1. 背景层

  - 给整个图形画一个方框，加上纯色/渐变着色器即完成背景绘制。

2. 线条层

  - 根据画布宽高和间距计算出绘制的线条个数 + 1，然后使用平移矩阵将线条层居中。
  - 线条颜色通过纯色/渐变画笔绘制。

3. 方格层

  - 根据画布宽高和间距计算出 x 方向和 y 方向上绘制的方格个数 + 1，然后根据奇偶数排列绘制矩形，并使用平移矩阵将整体居中。
  - 针对方格层图形进行渐变颜色填充或线条颜色填充绘制。

## 图形组合

1. 通过图形组件的属性控制是否绘制矩形、是否反转图形、是否透视图形、是否渐变颜色等。
2. 将两个或三个图形组件组合：
  - 根据规定的比例计算出对应的单个图形坐标；
  - 根据不同的图形组合确定不同的组件配置；
3. 横向图形变换：
  - 因图形组件已绘制为图层，需要进行图层的变换；
  - 调换宽高绘图，并将图层旋转 -90 度，通过矩阵计算新的 left/top 值。
